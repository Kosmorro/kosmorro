# appimage-builder recipe see https://appimage-builder.readthedocs.io for details
version: 1

script:
  - rm -rf build/AppDir | true
  - mkdir -p build/AppDir AppDir/usr/share/icons/hicolor/scalable/apps/
  - cp -r kosmorro/assets/svg/kosmorro-icon.svg  AppDir/usr/share/icons/hicolor/scalable/apps/kosmorro.svg
  - python3 -m pip install --ignore-installed --prefix=/usr --root=build/AppDir dist/kosmorro-*.whl

AppDir:
  path: build/AppDir
  app_info:
    id: space.kosmorro.cli
    name: kosmorro
    icon: kosmorro
    version: latest
    exec: usr/bin/python3
    exec_args: -m kosmorro $@

  runtime:
    env:
      PYTHONPATH: '$APPDIR/usr/local/lib/python3.10/site-packages'

  apt:
    arch: amd64
    sources:
      - sourceline: 'deb http://archive.ubuntu.com/ubuntu/ jammy main restricted'
        key_url: 'http://keyserver.ubuntu.com/pks/lookup?op=get&search=0xf6ecb3762474eda9d21b7022871920d1991bc93c'
    include:
      - python3
    exclude: []

  files:
    include:
      - '/usr/bin/env'

  test:
    fedora-30:
      image: appimagecrafters/tests-env:fedora-33
      command: ./AppRun --latitude=50.5824 --longitude=3.0624
      use_host_x: true
    debian-stable:
      image: appimagecrafters/tests-env:debian-stable
      command: ./AppRun --latitude=50.5824 --longitude=3.0624
      use_host_x: true
    archlinux-latest:
      image: appimagecrafters/tests-env:archlinux-latest
      command: ./AppRun --latitude=50.5824 --longitude=3.0624
      use_host_x: true
    centos-7:
      image: appimagecrafters/tests-env:centos-7
      command: ./AppRun --latitude=50.5824 --longitude=3.0624
      use_host_x: true
    ubuntu-xenial:
      image: appimagecrafters/tests-env:ubuntu-xenial
      command: ./AppRun --latitude=50.5824 --longitude=3.0624
      use_host_x: true

AppImage:
  arch: x86_64
  update-information: gh-releases-zsync|Kosmorro|kosmorro|latest|Kosmorro-*x86_64.AppImage.zsync
